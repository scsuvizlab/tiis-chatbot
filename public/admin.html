<!DOCTYPE html>
<html lang="en">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>NorthStar Admin Dashboard</title>
    <link rel="stylesheet" href="/styles.css">
    <style>
        /* Admin-specific styles */
        .admin-container {
            display: flex;
            min-height: 100vh;
            background: var(--bg-primary);
        }
        
        .admin-sidebar {
            width: 250px;
            background: var(--card-bg);
            border-right: 1px solid var(--border-color);
            padding: 2rem 1rem;
        }
        
        .admin-main {
            flex: 1;
            padding: 2rem;
            overflow-y: auto;
        }
        
        .tab-button {
            display: block;
            width: 100%;
            padding: 0.75rem 1rem;
            margin-bottom: 0.5rem;
            text-align: left;
            background: none;
            border: none;
            border-radius: 6px;
            cursor: pointer;
            color: var(--text-secondary);
            font-size: 0.95rem;
            transition: all 0.2s;
        }
        
        .tab-button:hover {
            background: var(--bg-secondary);
            color: var(--text-primary);
        }
        
        .tab-button.active {
            background: var(--primary-color);
            color: white;
        }
        
        .section {
            display: none;
        }
        
        .section.active {
            display: block;
        }
        
        .stats-grid {
            display: grid;
            grid-template-columns: repeat(auto-fit, minmax(200px, 1fr));
            gap: 1rem;
            margin-bottom: 2rem;
        }
        
        .stat-card {
            background: var(--card-bg);
            padding: 1.5rem;
            border-radius: 8px;
            border: 1px solid var(--border-color);
        }
        
        .stat-label {
            font-size: 0.875rem;
            color: var(--text-secondary);
            margin-bottom: 0.5rem;
        }
        
        .stat-value {
            font-size: 2rem;
            font-weight: 600;
            color: var(--text-primary);
        }
        
        .hidden {
            display: none !important;
        }
    </style>
</head>
<body>
    <div class="admin-container">
        <!-- Sidebar Navigation -->
        <div class="admin-sidebar">
            <h2 style="margin-bottom: 2rem; color: var(--text-primary);">NorthStar Admin</h2>
            
            <button id="users-tab" class="tab-button active" onclick="showSection('users')">
                üë• User Management
            </button>
            
            <button id="reports-tab" class="tab-button" onclick="showSection('reports')">
                üìä Reports
            </button>
            
            <button id="tools-tab" class="tab-button" onclick="showSection('tools')">
                üõ†Ô∏è Tools & Platforms
            </button>
            
            <button id="knowledge-tab" class="tab-button" onclick="showSection('knowledge')">
                üìö Knowledge Modules
            </button>
            
            <button id="voice-management-btn" class="tab-button">
                üéôÔ∏è Voice Management
            </button>
            
            <button id="export-tab" class="tab-button" onclick="showSection('export')">
                üíæ Data Export
            </button>
            
            <hr style="margin: 2rem 0; border: none; border-top: 1px solid var(--border-color);">
            
            <button id="logout-btn" class="tab-button" onclick="handleLogout()">
                üö™ Logout
            </button>
        </div>
        
        <!-- Main Content Area -->
        <div class="admin-main">
            <!-- Login Screen -->
            <div id="login-screen" class="section active">
                <div style="max-width: 400px; margin: 4rem auto;">
                    <h1 style="margin-bottom: 2rem;">Admin Login</h1>
                    
                    <form id="admin-login-form">
                        <div style="margin-bottom: 1rem;">
                            <label style="display: block; margin-bottom: 0.5rem;">Admin Password</label>
                            <input type="password" id="admin-password" required 
                                   style="width: 100%; padding: 0.75rem; border-radius: 6px; border: 1px solid var(--border-color);">
                        </div>
                        
                        <div id="login-error" class="hidden" style="color: var(--error-color); margin-bottom: 1rem;"></div>
                        
                        <button type="submit" class="button-primary" style="width: 100%;">
                            Login
                        </button>
                    </form>
                </div>
            </div>
            
            <!-- Users Section -->
            <div id="users-section" class="section">
                <div style="display: flex; justify-content: space-between; align-items: center; margin-bottom: 2rem;">
                    <h1>üë• User Management</h1>
                    <button id="create-user-btn" class="button-primary">+ Create User</button>
                </div>
                
                <!-- Stats -->
                <div class="stats-grid">
                    <div class="stat-card">
                        <div class="stat-label">Total Users</div>
                        <div class="stat-value" id="stat-total-users">-</div>
                    </div>
                    <div class="stat-card">
                        <div class="stat-label">Onboarding Complete</div>
                        <div class="stat-value" id="stat-onboarding">-</div>
                    </div>
                    <div class="stat-card">
                        <div class="stat-label">Total Tasks</div>
                        <div class="stat-value" id="stat-tasks">-</div>
                    </div>
                    <div class="stat-card">
                        <div class="stat-label">Total Messages</div>
                        <div class="stat-value" id="stat-messages">-</div>
                    </div>
                </div>
                
                <!-- Users Table -->
                <div id="users-table-container"></div>
            </div>
            
            <!-- Reports Section -->
            <div id="reports-section" class="section">
                <h1>üìä Reports</h1>
                <p style="color: var(--text-secondary); margin-bottom: 2rem;">
                    Generate AI-powered analysis reports for your organization
                </p>
                
                <div id="reports-content">
                    <p>Report generation interface</p>
                </div>
            </div>
            
            <!-- Tools & Platforms Section -->
            <div id="tools-section" class="section">
                <h1>üõ†Ô∏è Tools & Platforms</h1>
                <p style="color: var(--text-secondary); margin-bottom: 2rem;">
                    View and analyze software, tools, and platforms used across your organization
                </p>
                
                <div id="tools-container"></div>
            </div>
            
            <!-- Knowledge Modules Section -->
            <div id="knowledge-section" class="section">
                <div id="knowledge-container"></div>
            </div>
            
            <!-- Export Section -->
            <div id="export-section" class="section">
                <h1>üíæ Data Export</h1>
                <p style="color: var(--text-secondary); margin-bottom: 2rem;">
                    Export conversation data and user information
                </p>
                
                <div id="export-content">
                    <div style="margin-bottom: 3rem;">
                        <button id="export-all-btn" class="button-primary" style="margin-bottom: 0.5rem;">
                            üì¶ Download All Data (JSON)
                        </button>
                        <p style="color: var(--text-secondary); font-size: 0.875rem;">
                            Exports all users and conversations in a single file
                        </p>
                    </div>
                    
                    <div>
                        <h3 style="margin-bottom: 1rem;">Export by User</h3>
                        <p style="color: var(--text-secondary); margin-bottom: 1rem; font-size: 0.875rem;">
                            Download data for individual users (useful for excluding test users)
                        </p>
                        <div id="export-user-list" style="border: 1px solid var(--border-color); border-radius: 8px; overflow: hidden;">
                            <div style="padding: 2rem; text-align: center; color: var(--text-secondary);">
                                Loading users...
                            </div>
                        </div>
                    </div>
                </div>
            </div>
        </div>
    </div>
    
    <!-- Voice Management Modal -->
    <div id="voice-modal" class="modal hidden">
        <div class="modal-content" style="max-width: 900px; max-height: 85vh; overflow-y: auto;">
            <div style="display: flex; justify-content: space-between; align-items: center; margin-bottom: 1.5rem; padding-bottom: 1rem; border-bottom: 2px solid var(--border-color);">
                <h2 style="margin: 0;">üéôÔ∏è Voice Management</h2>
                <button id="close-voice-modal-btn" class="btn btn-secondary" style="font-size: 1.5rem; line-height: 1;">√ó</button>
            </div>
            
            <div id="voice-status-message" class="hidden" style="margin-bottom: 1rem; padding: 0.75rem; border-radius: 6px;"></div>
            
            <div style="margin-bottom: 2rem;">
                <label style="display: block; margin-bottom: 0.5rem; font-weight: 600;">Default Voice</label>
                <select id="default-voice-select" style="width: 100%; padding: 0.75rem; border: 1px solid var(--border-color); border-radius: 6px; font-size: 1rem;">
                    <option value="">Loading...</option>
                </select>
            </div>
            
            <div style="margin-bottom: 1.5rem;">
                <div style="display: flex; justify-content: space-between; align-items: center; margin-bottom: 1rem;">
                    <h3 style="margin: 0;">Configured Voices</h3>
                    <div style="display: flex; gap: 0.5rem;">
                        <button id="browse-api-voices-btn" class="btn btn-secondary">üîç Browse API Voices</button>
                        <button id="add-voice-btn" class="btn btn-primary">+ Add Voice</button>
                    </div>
                </div>
                <div id="voices-list" style="border: 1px solid var(--border-color); border-radius: 6px; padding: 1rem; min-height: 200px; background: var(--bg-primary);">
                    <p style="text-align: center; color: var(--text-secondary);">Loading voices...</p>
                </div>
            </div>
            
            <div style="text-align: right;">
                <button id="save-voice-config-btn" class="btn btn-primary">üíæ Save Configuration</button>
            </div>
        </div>
    </div>

    <!-- Voice Form Modal -->
    <div id="voice-form-modal" class="modal hidden">
        <div class="modal-content" style="max-width: 500px;">
            <h2 id="voice-form-title" style="margin-bottom: 1.5rem;">Add Voice</h2>
            <form id="voice-form">
                <div style="margin-bottom: 1rem;">
                    <label style="display: block; margin-bottom: 0.5rem; font-weight: 600;">Voice ID (from ElevenLabs)</label>
                    <input type="text" id="voice-id-input" required placeholder="e.g., 21m00Tcm4TlvDq8ikWAM" style="width: 100%; padding: 0.75rem; border: 1px solid var(--border-color); border-radius: 6px; font-size: 1rem;">
                </div>
                <div style="margin-bottom: 1rem;">
                    <label style="display: block; margin-bottom: 0.5rem; font-weight: 600;">Display Name</label>
                    <input type="text" id="voice-name-input" required placeholder="e.g., Rachel - Professional" style="width: 100%; padding: 0.75rem; border: 1px solid var(--border-color); border-radius: 6px; font-size: 1rem;">
                </div>
                <div style="margin-bottom: 1.5rem;">
                    <label style="display: block; margin-bottom: 0.5rem; font-weight: 600;">Description (Optional)</label>
                    <textarea id="voice-desc-input" rows="3" placeholder="Brief description..." style="width: 100%; padding: 0.75rem; border: 1px solid var(--border-color); border-radius: 6px; font-size: 1rem;"></textarea>
                </div>
                <div style="display: flex; gap: 1rem; justify-content: flex-end;">
                    <button type="button" id="cancel-voice-form-btn" class="btn btn-secondary">Cancel</button>
                    <button type="submit" class="btn btn-primary">Save Voice</button>
                </div>
            </form>
        </div>
    </div>

    <!-- API Voices Browser Modal -->
    <div id="api-voices-modal" class="modal hidden">
        <div class="modal-content" style="max-width: 800px; max-height: 80vh; overflow-y: auto;">
            <div style="display: flex; justify-content: space-between; align-items: center; margin-bottom: 1.5rem;">
                <h2 style="margin: 0;">Browse ElevenLabs API Voices</h2>
                <button id="close-api-voices-btn" class="btn btn-secondary" style="font-size: 1.5rem; line-height: 1;">√ó</button>
            </div>
            <div id="api-voices-list"></div>
        </div>
    </div>
    
    <!-- Load Scripts -->
    <script src="/admin-dashboard.js"></script>
    <script src="/admin-tools-manager.js"></script>
    <script src="/admin-knowledge-manager.js"></script>
    <script src="/admin-voice-manager.js"></script>
</body>
</html>